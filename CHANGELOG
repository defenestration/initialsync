#Changelog ############
# Dec19 mysqldbfinalsync, added more logging to /tmp/mysqldump.log so it would show database names. want to add a db only sync.
# Dec 25 simplified single user sync
# Dec 26 Added "actions taken" to end of final sync.
# Jan 4 2012 added updating rsync to greater than 3, and logging for rsync/ found rsync loggin wiht --log-file isn't that useful actually :/  probably will want to log output of --stats but it adds the same output as -v
# added scriptlog for version, start, choice, end times.
# Jan 5 fixed rsync version comapre string
# Jan 8 2012 wrapped variable in if statement in quotes in mysqlextradbcheck
#  added rsync upgrade to final sync
#  added apacheprepostcheck function to presync
# Jan 16 2012 - implemented dbsync function.
#  Added dnsclustercheck function.
#  Tweaked apacheprepostcheck to print file contents and backup the conf file before copying.
# Jan 17 2012 - Fixed  so mysql actually updates.
# Jan 18 2012 - Added hosts/dbsync file script code into this script
# Jan 19 2012 - Added additional queries for finalsync userlist verification.
#  Added rsync logging and adjusted scriptlog location
# Jan 22 2012 - Stop Ipaliases on new server if keepoldips is set.
#  Added logging of pkgacct and restorepkg instead of showing to screen.
# Jan 26 2012 - Memcache install was broken, missing a space >_< fixed.
# Jan 29 2012 - Added mysqlsymlink check
# Feb 1  2012 - added reloading for nsd nameserver
#  moved imagic ffmpeg and memcache to final checks so they are installed after EA
# Feb 2  2012 - added SSL cert check, removed IP sync migration.
# Feb 6 2012 -  Moved sslcertcheck to presync.
# Feb 16 2012 - Added gcccheck
# Feb 22 2012 - Fixed path of the dest.port.txt file when inputting new destination server ip
#  Updated single user sync to restore original authorized_keys on destination server after sync (for shared server moves)
# Feb 28 2012 - Fixed upcp from running twice
# Mar 22 2012 - Fixed postgres find.
# Mar 29 2012 - Added rubygems function.
# Apr 2 2012 - Fixed dbsync screen name
# Apr 16 2012 source ip count improvements by jmuffett
#   added dbonlysync var to check if only mysqldump menu option was ran.
# Apr 17 - removed dbonlysync var, final sync wasn't syncing dbs.
# Apr 19 - Added option to invoke --update during final rsync, rsyncupdate
# added cpbackupcheck to enable cpanel backups on the remote server.
# Apr 20 - clarified Override Ip check question text
# Apr 30 - Fixed cpbackupcheck, path to cpbackup.conf
# May  1 - Changed lowerttls to a find/sed to avoid bash wildcard completion errors
# May  8 - postgresfound variable was not set earlier, so postgres wouldn't get installed, changed variable to postgres.
# May 16 - dnscheck now checks for domains owned by users in /root/userlist.txt - awalilko
# May 18 - /home/dbdumps wasn't renamed on the new server during initial sync, this could cause issues if there was a previous migration. set to rename that folder with a date on hte new server.
# May 21 - Also check and rename /home/dbdumps on source server | skip logaholicDB copying.
# May 25 - switched Lower TTLS to perl as sed -i doesn't exist in old versions of sed
# Jun 05 - Added logging for which users were being migrated.
# Jun 22 - Quoted remotednscluster like 395ish, clarified text there a little.
# Jun 28 - Removed rsync upgrade from single user sync.
# Jul 23 - Remove safe-show-database and skip-locking from my.cnf if mysql is being upgraded to a version greater than 5.
# Jul 27 - Trimmed extra check function out of mysqlsymlinkcheck, updated eximcheck in finalchecks to compare ports between servers.
# Jul 31 - Added logvars function to simplify logging, added in some areas of script.
# Aug 7  - Exclude databases with * in the name from mysql -e show databases
# Aug 24 - Fixed logvars function to not overwrite the log :D
# Aug 29 - Added -y to gcc install
# Sep 12 - Added more logging
# Oct  2 - Option for Dedicated Ip in single user sync
# Oct  5 - more logging to sshkeygen
# Oct 22 - added option to remove ssh key at the end of final sync. 
# Nov  1 - added logit function, claned up some yesNo questions
# Nov  5 - logging during cpanel account restore. matchpear function by jacob, improved logvars, improved restorepkg logic, numbering restored accounts
# Nov  7 - Minor update to 'was EA ran' query, detecition that cpmove file was created on source before coyping. Didnotrestore.txt changed to /root directory.
# Nov 20 - add allcpusers variable to filter out 'root' and 'system' from cpanel users. Initial Color support.
# Nov 21 - e2c function, colorizing. removed some keepoldips code.
# Nov 27 - Check for screen session, backup /root/domainlist.txt, /root/userlist.txt
# Dec 17 - removed possibility for * entries in preliminary_ip_check variable
# Dec 18 - check /home* for cpmove files
# Jan 16 2013 - authorized_keys was still holding the key if it was written to twice.  expanded so that authorized_keys.initialsyncbak wouldn't be overwritten if it existed. 
# Jan 23 - added gem install to a screen, sometimes it holds up the migration.  started modsec function. postmigrationhook
# Feb 20 - More verbose error and added pause for finding multiple cpmove files for a user in /home2 /home3 etc.  also download a remoteuserlist from the destination server to compare rather than SSH to check each time.  remove final sync of /var/spool, since supposedly causes issues with cent6.
# Mar 20 - Updated mysql update command for cpanel 11.36
# Apr 8 - updated hosts.sh script
